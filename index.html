<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جداول الطالبات | Quran</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #E0F7FA; /* لون أزرق فاتح */
            direction: rtl;
        }
        .container {
            width: 90%;
            max-width: 600px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #0288D1; /* أزرق */
            color: white;
        }
        button {
            background: #0288D1;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        .delete-btn {
            background: red;
            color: white;
            border: none;
            padding: 5px;
            border-radius: 3px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>جدول الحفظ</h2>
        <input type="text" id="studentName" placeholder="أدخل اسم الطالبة">
        <h3 id="displayName"></h3>

        <table id="scheduleTable">
            <thead>
                <tr>
                    <th>اليوم</th>
                    <th>مقدار الحفظ</th>
                    <th>المراجعة</th>
                    <th>تم الإنجاز</th>
                    <th>حذف</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>الأحد</td>
                    <td onclick="editCell(this)">...</td>
                    <td onclick="editCell(this)">...</td>
                    <td><div class="checkbox" onclick="toggleCheck(this)"></div></td>
                    <td><button class="delete-btn" onclick="deleteRow(this)">حذف</button></td>
                </tr>
            </tbody>
        </table>

        <button onclick="saveTableData()">حفظ الجدول</button>
        <button onclick="window.location.href='all-tables.html'">عرض جميع الجداول</button>
    </div>

    <script>
        let studentName = "";

        function editCell(cell) {
            let input = document.createElement("input");
            input.type = "text";
            input.value = cell.textContent;
            cell.textContent = "";
            cell.appendChild(input);
            input.focus();

            input.onblur = function () {
                cell.textContent = input.value;
                saveTableData();
            };
        }

        function toggleCheck(element) {
            element.classList.toggle("checked");
            saveTableData();
        }

        function deleteRow(button) {
            button.parentElement.parentElement.remove();
            saveTableData();
        }

        function saveTableData() {
            if (studentName === "") {
                alert("يرجى إدخال اسم الطالبة أولاً.");
                return;
            }

            let tableData = [];
            let rows = document.querySelectorAll("#scheduleTable tbody tr");

            rows.forEach(row => {
                let cells = row.getElementsByTagName("td");
                let rowData = {
                    day: cells[0].textContent,
                    memorization: cells[1].textContent,
                    review: cells[2].textContent,
                    completed: cells[3].querySelector("div").classList.contains("checked")
                };
                tableData.push(rowData);
            });

            localStorage.setItem(`scheduleData_${studentName}`, JSON.stringify(tableData));
        }

        function loadTableData() {
            const urlParams = new URLSearchParams(window.location.search);
            studentName = urlParams.get("student") || "";

            if (studentName) {
                document.getElementById("studentName").value = studentName;
                document.getElementById("displayName").textContent = studentName;
                document.getElementById("studentName").style.display = "none";
            }

            let tableData = JSON.parse(localStorage.getItem(`scheduleData_${studentName}`));
            if (!tableData) return;

            let table = document.getElementById("scheduleTable").getElementsByTagName("tbody")[0];
            table.innerHTML = "";

            tableData.forEach(rowData => {
                let newRow = table.insertRow();
                newRow.insertCell(0).textContent = rowData.day;

                let memorizationCell = newRow.insertCell(1);
                memorizationCell.textContent = rowData.memorization;
                memorizationCell.onclick = function () {
                    editCell(memorizationCell);
                };

                let reviewCell = newRow.insertCell(2);
                reviewCell.textContent = rowData.review;
                reviewCell.onclick = function () {
                    editCell(reviewCell);
                };

                let checkCell = newRow.insertCell(3);
                let checkBox = document.createElement("div");
                checkBox.className = "checkbox";
                if (rowData.completed) checkBox.classList.add("checked");
                checkBox.onclick = function () {
                    checkBox.classList.toggle("checked");
                    saveTableData();
                };
                checkCell.appendChild(checkBox);

                let deleteCell = newRow.insertCell(4);
                let deleteButton = document.createElement("button");
                deleteButton.className = "delete-btn";
                deleteButton.textContent = "حذف";
                deleteButton.onclick = function () {
                    newRow.remove();
                    saveTableData();
                };
                deleteCell.appendChild(deleteButton);
            });
        }

        window.onload = loadTableData;
    </script>
</body>
</html>